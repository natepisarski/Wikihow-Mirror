{"version":3,"sources":["webpack://mfModules.[name]/./src/mobile.notifications.overlay/NotificationsFilterOverlay.js","webpack://mfModules.[name]/./src/mobile.notifications.overlay/NotificationsOverlay.js","webpack://mfModules.[name]/./src/mobile.notifications.overlay/mobile.notifications.overlay.js"],"names":["NotificationsFilterOverlay","Overlay","require","util","mfExtend","options","self","this","call","extend","className","on","mainMenu","closeNavigationDrawers","$crossWikiUnreadFilter","hide","$notifReadState","find","$el","append","parseHTML","addClass","defaults","prototype","heading","mw","msg","preRender","message","escaped","module","exports","NotificationsOverlay","Anchor","params","modelManager","unreadCounter","wrapperWidget","isBorderBox","maxNotificationCount","config","get","echoApi","echo","api","EchoApi","badge","$overlay","error","onError","maxPrioritizedActions","doneLoading","dm","UnreadNotificationCounter","ModelManager","type","controller","Controller","ui","NotificationsWrapper","markAllReadButton","OO","ButtonWidget","icon","title","toggle","$element","confirmationWidget","ConfirmationPopupWidget","connect","countChange","update","click","populate","then","setDoneLoading","updateSeenTime","markAsSeen","checkShowMarkAllRead","footerAnchor","href","getUrl","progressive","additionalClassNames","label","isDoneLoading","manager","hasLocalUnread","onMarkAllReadButtonClick","overlay","numNotifications","getLocalUnread","length","markLocalNotificationsRead","setLabel","showAnimated","onUnreadCountChange","count","setCount","getUnreadCounter","getCappedNotificationCount","postRender","apply","notifications","errorMessage","remove","m","define"],"mappings":"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","file":"mobile.notifications.overlay.js","sourcesContent":["var Overlay = require( '../mobile.startup/Overlay' ),\n\tutil = require( '../mobile.startup/util' ),\n\tmfExtend = require( '../mobile.startup/mfExtend' ),\n\tNotificationsFilterOverlay;\n\n/**\n * Overlay for notifications filter\n *\n * @class NotificationsFilterOverlay\n * @extends Overlay\n * @param {Object} options\n * @param {jQuery.Object} options.$notifReadState - notification read status widgets\n * @param {jQuery.Object} options.$crossWikiUnreadFilter - notification unread filter\n *\n */\nNotificationsFilterOverlay = function ( options ) {\n\tvar self = this;\n\n\tOverlay.call(\n\t\tthis,\n\t\tutil.extend( {\n\t\t\t// FIXME: notification-overlay class to be generalized\n\t\t\tclassName: 'overlay notifications-filter-overlay notifications-overlay navigation-drawer'\n\t\t}, options )\n\t);\n\n\t// Initialize\n\tthis.on( 'hide', function () {\n\t\toptions.mainMenu.closeNavigationDrawers();\n\t} );\n\toptions.$crossWikiUnreadFilter.on( 'click', function () {\n\t\tself.hide();\n\t} );\n\n\toptions.$notifReadState.find( '.oo-ui-buttonElement' ).on( 'click', function () {\n\t\tself.hide();\n\t} );\n\n\tthis.$el.find( '.overlay-content' ).append(\n\t\tthis.parseHTML( '<div>' )\n\t\t\t.addClass( 'notifications-filter-overlay-read-state' )\n\t\t\t.append( options.$notifReadState ),\n\t\toptions.$crossWikiUnreadFilter\n\t);\n};\n\nmfExtend( NotificationsFilterOverlay, Overlay, {\n\t/**\n\t * @memberof NotificationsFilterOverlay\n\t * @instance\n\t * @mixes Overlay#defaults\n\t * @property {Object} defaults Default options hash.\n\t * @property {string} defaults.heading Heading text.\n\t */\n\tdefaults: util.extend( {}, Overlay.prototype.defaults, {\n\t\theading: mw.msg( 'mobile-frontend-notifications-filter-title' )\n\t} ),\n\n\t/**\n\t * @inheritdoc\n\t * @memberof NotificationsFilterOverlay\n\t * @instance\n\t */\n\tpreRender: function () {\n\t\tthis.options.heading = '<strong>' + mw.message( 'mobile-frontend-notifications-filter-title' ).escaped() + '</strong>';\n\t}\n} );\n\nmodule.exports = NotificationsFilterOverlay;\n","var Overlay = require( '../mobile.startup/Overlay' ),\n\tutil = require( '../mobile.startup/util' ),\n\tmfExtend = require( '../mobile.startup/mfExtend' ),\n\tAnchor = require( '../mobile.startup/Anchor' ),\n\tNotificationsOverlay;\n\n/**\n * Overlay for notifications\n * @class NotificationsOverlay\n * @extend Overlay\n * @uses mw.Api\n *\n * @param {Object} params Configuration options\n */\nNotificationsOverlay = function ( params ) {\n\tvar modelManager, unreadCounter, wrapperWidget,\n\t\tself = this,\n\t\toptions = util.extend( {}, {\n\t\t\tisBorderBox: false,\n\t\t\tclassName: 'overlay notifications-overlay navigation-drawer'\n\t\t}, params ),\n\t\tmaxNotificationCount = mw.config.get( 'wgEchoMaxNotificationCount' ),\n\t\techoApi = new mw.echo.api.EchoApi();\n\n\tOverlay.call( this, options );\n\n\t// Anchor tag that corresponds to a notifications badge\n\tthis.badge = options.badge;\n\tthis.$overlay = this.parseHTML( '<div>' )\n\t\t.addClass( 'notifications-overlay-overlay position-fixed' );\n\n\t// On error use the url as a fallback\n\tif ( options.error ) {\n\t\toptions.onError();\n\t\treturn;\n\t}\n\n\tmw.echo.config.maxPrioritizedActions = 1;\n\n\tthis.doneLoading = false;\n\n\tunreadCounter = new mw.echo.dm.UnreadNotificationCounter( echoApi, 'all', maxNotificationCount );\n\tmodelManager = new mw.echo.dm.ModelManager( unreadCounter, { type: [ 'message', 'alert' ] } );\n\tthis.controller = new mw.echo.Controller(\n\t\techoApi,\n\t\tmodelManager,\n\t\t{\n\t\t\ttype: [ 'message', 'alert' ]\n\t\t}\n\t);\n\n\twrapperWidget = new mw.echo.ui.NotificationsWrapper( this.controller, modelManager, {\n\t\t$overlay: this.$overlay\n\t} );\n\n\t// Mark all read\n\tthis.markAllReadButton = new OO.ui.ButtonWidget( {\n\t\ticon: 'checkAll',\n\t\ttitle: mw.msg( 'echo-mark-all-as-read' )\n\t} );\n\tthis.markAllReadButton.toggle( false );\n\tthis.$el.find( '.overlay-header' )\n\t\t.append(\n\t\t\tthis.parseHTML( '<div>' )\n\t\t\t\t.addClass( 'notifications-overlay-header-markAllRead' )\n\t\t\t\t.append(\n\t\t\t\t\tthis.markAllReadButton.$element\n\t\t\t\t)\n\t\t);\n\n\t// TODO: We should be using 'toast' (which uses mw.notify)\n\t// when this bug is fixed: https://phabricator.wikimedia.org/T143837\n\tthis.confirmationWidget = new mw.echo.ui.ConfirmationPopupWidget();\n\tthis.$overlay.append( this.confirmationWidget.$element );\n\n\t// Events\n\tunreadCounter.connect( this, {\n\t\tcountChange: 'onUnreadCountChange'\n\t} );\n\tmodelManager.connect( this, {\n\t\tupdate: 'checkShowMarkAllRead'\n\t} );\n\tthis.markAllReadButton.connect( this, {\n\t\tclick: 'onMarkAllReadButtonClick'\n\t} );\n\n\t// Initialize\n\tthis.$el.find( '.overlay-content' ).append(\n\t\twrapperWidget.$element,\n\t\tthis.$overlay\n\t);\n\n\t// Populate notifications\n\twrapperWidget.populate().then( function () {\n\t\tself.setDoneLoading();\n\t\tself.controller.updateSeenTime();\n\t\tself.badge.markAsSeen();\n\t\tself.checkShowMarkAllRead();\n\t} );\n};\n\nmfExtend( NotificationsOverlay, Overlay, {\n\t/**\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t * @mixes Overlay#defaults\n\t * @property {Object} defaults Default options hash.\n\t * @property {string} defaults.heading Heading text.\n\t */\n\tdefaults: util.extend( {}, Overlay.prototype.defaults, {\n\t\theading: mw.msg( 'notifications' ),\n\t\tfooterAnchor: new Anchor( {\n\t\t\thref: mw.util.getUrl( 'Special:Notifications' ),\n\t\t\tprogressive: true,\n\t\t\tadditionalClassNames: 'footer-link notifications-archive-link',\n\t\t\tlabel: mw.msg( 'echo-overlay-link' )\n\t\t} ).options\n\t} ),\n\t/**\n\t * Set done loading flag for notifications list\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t */\n\tsetDoneLoading: function () {\n\t\tthis.doneLoading = true;\n\t},\n\t/**\n\t * Check if notifications have finished loading\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t * @return {boolean} Notifications list has finished loading\n\t */\n\tisDoneLoading: function () {\n\t\treturn this.doneLoading;\n\t},\n\t/**\n\t * Toggle mark all read button\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t */\n\tcheckShowMarkAllRead: function () {\n\t\tthis.markAllReadButton.toggle(\n\t\t\tthis.isDoneLoading() &&\n\t\t\tthis.controller.manager.hasLocalUnread()\n\t\t);\n\t},\n\t/**\n\t * Respond to mark all read button click\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t */\n\tonMarkAllReadButtonClick: function () {\n\t\tvar overlay = this,\n\t\t\tnumNotifications = this.controller.manager.getLocalUnread().length;\n\n\t\tthis.controller.markLocalNotificationsRead()\n\t\t\t.then( function () {\n\t\t\t\toverlay.confirmationWidget.setLabel(\n\t\t\t\t\tmw.msg( 'echo-mark-all-as-read-confirmation', numNotifications )\n\t\t\t\t);\n\t\t\t\toverlay.confirmationWidget.showAnimated();\n\t\t\t} );\n\t},\n\t/**\n\t * Update the unread number on the notifications badge\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t * @param {number} count Number of unread notifications\n\t */\n\tonUnreadCountChange: function ( count ) {\n\t\tthis.badge.setCount(\n\t\t\tthis.controller.manager.getUnreadCounter().getCappedNotificationCount( count )\n\t\t);\n\n\t\tthis.checkShowMarkAllRead();\n\t},\n\t/**\n\t * @inheritdoc\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t */\n\tpreRender: function () {\n\t\tthis.options.heading = '<strong>' + mw.message( 'notifications' ).escaped() + '</strong>';\n\t},\n\t/**\n\t * @inheritdoc\n\t * @memberof NotificationsOverlay\n\t * @instance\n\t */\n\tpostRender: function () {\n\t\tOverlay.prototype.postRender.apply( this );\n\n\t\tif ( this.options.notifications || this.options.errorMessage ) {\n\t\t\tthis.$el.find( '.loading' ).remove();\n\t\t}\n\t}\n} );\n\nmodule.exports = NotificationsOverlay;\n","var m = require( './../mobile.startup/moduleLoaderSingleton' ),\n\tNotificationsOverlay = require( './NotificationsOverlay' ),\n\tNotificationsFilterOverlay = require( './NotificationsFilterOverlay' );\n\nm.define( 'mobile.notifications.overlay/NotificationsFilterOverlay', NotificationsFilterOverlay );\nm.define( 'mobile.notifications.overlay/NotificationsOverlay', NotificationsOverlay );\n"],"sourceRoot":""}