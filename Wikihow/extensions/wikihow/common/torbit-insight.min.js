/* Copyright and full source available at: http://insight.torbit.com/v1/rum.js */ var TBRUM=TBRUM||EPISODES||{};TBRUM.q=TBRUM.q||[];TBRUM.q.push(["mark","script-firstbyte",(new Date).getTime()]);TBRUM.version="0.2";TBRUM.perf_obj=false;if(Math.random&&Math.random()<.9)TBRUM.beaconUrl=TBRUM.beaconUrl||"//insight.torbit.com/beacon.gif";else TBRUM.beaconUrl=TBRUM.beaconUrl||"//i.nsig.ht/beacon.gif";TBRUM.autorun="undefined"!=typeof TBRUM.autorun?TBRUM.autorun:true;TBRUM.init=function(){TBRUM.bDone=false;TBRUM.marks={};TBRUM.measures={};TBRUM.starts={};TBRUM.addEventListener("beforeunload",TBRUM.beforeUnload,false);TBRUM.addEventListener("load",TBRUM.onload,false);(function(){var e=false;var t=function(){};var n=function(e){t=r(e);i()};var r=function(t){return function(){if(!e){e=true;t()}}};var i=function(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",t,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",t);var e=false;try{e=window.frameElement==null}catch(n){}if(document.documentElement.doScroll&&e){s()}}};var s=function(){if(e){return}try{document.documentElement.doScroll("left")}catch(n){setTimeout(s,5);return}t()};n(function(){TBRUM.mark("onready");TBRUM.measure("onready","starttime","onready")})})();TBRUM.processQ();TBRUM.findStartTime()};TBRUM.processQ=function(){var e=TBRUM.q.length;for(var t=0;t<e;t++){var n=TBRUM.q[t];var r=n[0];if("mark"===r){TBRUM.mark(n[1],n[2])}else if("measure"===r){TBRUM.measure(n[1],n[2],n[3])}else if("done"===r){TBRUM.done(n[1])}else if("tags"===r){if(TBRUM.tags)TBRUM.tags+=",";else TBRUM.tags="";TBRUM.tags+=n[1]}else if("conv"===r){TBRUM.conversions=n.slice(1).join("|")}}};TBRUM.q.push=function(){var e=Array.prototype.slice.call(arguments[0],0);var t=e[0];var n=e.slice(1);if("conv"==t){TBRUM.conversions=n.join("|");if(TBRUM.bDone)TBRUM.beaconWrapper()}else if("tags"===t){if(TBRUM.tags)TBRUM.tags+=",";else TBRUM.tags="";TBRUM.tags+=arguments[0][1]}};TBRUM.mark=function(e,t){if(!e){return}TBRUM.marks[e]=parseInt(t||(new Date).getTime());if("firstbyte"===e){TBRUM.measure("backend","starttime","firstbyte")}else if("onload"===e){TBRUM.measure("frontend","firstbyte","onload");TBRUM.measure("onload","starttime","onload")}else if("done"===e){TBRUM.measure("total_load_time","starttime","done")}};TBRUM.measure=function(e,t,n){if(!e){return}var r;if("undefined"===typeof t){if("number"===typeof TBRUM.marks[e]){r=TBRUM.marks[e]}else{r=(new Date).getTime()}}else if("number"===typeof TBRUM.marks[t]){r=TBRUM.marks[t]}else if("number"===typeof t){r=t}else{return}var i;if("undefined"===typeof n){i=(new Date).getTime()}else if("number"===typeof TBRUM.marks[n]){i=TBRUM.marks[n]}else if("number"===typeof n){i=n}else{return}TBRUM.starts[e]=parseInt(r);TBRUM.measures[e]=parseInt(i-r)};TBRUM.done=function(e){TBRUM.mark("done");var t=TBRUM.measure;if(TBRUM.perf_obj){var n=TBRUM.mark;var r=window.performance.timing;for(var i in r){n(i,r[i])}t("red_t","redirectStart","redirectEnd");t("cache_t","fetchStart","domainLookupStart");t("dns_t","domainLookupStart","domainLookupEnd");t("tcp_t","connectStart","connectEnd");t("b_wait_t","requestStart","responseStart");t("b_tran_t","responseStart","responseEnd");t("onready_t","navigationStart","domContentLoadedEventStart");t("onload_t","navigationStart","loadEventStart");t("scr_proc_t","script-firstbyte","script-done")}if(TBRUM.autorun&&!TBRUM.bDone){TBRUM.beaconWrapper();if(TBRUM.measures["onload_t"]&&TBRUM.measures["onload_t"]>0)onload_time=TBRUM.measures["onload_t"];else if(TBRUM.measures["onload"]&&TBRUM.measures["onload"]>0)onload_time=TBRUM.measures["onload"];cookie_str=TBRUM.getCookie("TBTIM");if(cookie_str){parts=cookie_str.split("|");if(parts.length<2){cookie_str=onload_time+"|1"}else{cookie_str=parseInt(parts[0])+onload_time+"|"+(parseInt(parts[1])+1)}}else{cookie_str=onload_time+"|1"}TBRUM.setCookie("TBTIM",cookie_str,true)}TBRUM.bDone=true;if("function"===typeof e){e()}};TBRUM.beaconWrapper=function(){TBRUM.sendBeacon(false,{src:TBRUM.src,tbtim:TBRUM.getCookie("TBTIM"),conversion:TBRUM.conversions||"",tags:TBRUM.tags||""})};TBRUM.sendBeacon=function(e,t){e=e||TBRUM.beaconUrl;var n=TBRUM.measures;var r="?";for(var i in n){r+=escape(i)+"="+n[i]+"&"}if(r.length>1){r=r.substr(0,r.length-1);if(t){for(var i in t){if(t.hasOwnProperty(i)){r+="&"+escape(i)+"="+escape(t[i])}}}TBRUM.img_beacon=new Image;TBRUM.img_beacon.src=e+r+"&v="+TBRUM.version;return TBRUM.img_beacon.src}return""};TBRUM.findStartTime=function(){var e=TBRUM.findStartWebTiming()||TBRUM.findStartGToolbar()||TBRUM.findStartCookie();if(!e&&TBRUM.marks["firstbyte"]){e=TBRUM.marks["firstbyte"];TBRUM.src="inline"}if(e){TBRUM.mark("starttime",e)}};TBRUM.findStartWebTiming=function(){var e=undefined;if(navigator.userAgent.match(/Firefox/i))return false;var t=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance;if("undefined"!=typeof t&&"undefined"!=typeof t.timing&&"undefined"!=typeof t.timing["navigationStart"]){TBRUM.perf_obj=true;e=t.timing["navigationStart"];TBRUM.src="nav"}return e};TBRUM.findStartGToolbar=function(){var e=undefined;if("undefined"!=typeof window.external&&"undefined"!=typeof window.external.pageT){e=(new Date).getTime()-window.external.pageT}else if("undefined"!=typeof window.gtbExternal&&"undefined"!=typeof window.gtbExternal.pageT){e=(new Date).getTime()-window.gtbExternal.pageT()}else if("undefined"!=typeof window.chrome&&"undefined"!=typeof window.chrome.csi){e=(new Date).getTime()-window.chrome.csi().pageT}if(e)TBRUM.src="gt";return e};TBRUM.findStartCookie=function(){var e=document.cookie.split(" ");for(var t=0;t<e.length;t++){if(0===e[t].indexOf("TBRUM=")){var n=e[t].substring("TBRUM=".length).split("&");var r,i;for(var s=0;s<n.length;s++){if(0===n[s].indexOf("s=")){r=n[s].substring(2)}else if(0===n[s].indexOf("r=")){var o=n[s].substring(2);i=escape(document.referrer)==o}}if(i&&r){TBRUM.src="cook";return r}}}return undefined};TBRUM.getCookie=function(e){var t=document.cookie;var n=t.indexOf(e);var r=t.indexOf(";",n)==-1?t.length:t.indexOf(";",n);if(n==-1)return"";return unescape(t.substring(n+(e.length+1),r))};TBRUM.setCookie=function(e,t,n){if(!e||!t){return 0}if(n){var r=new Date((new Date).getTime()+(new Date).getTimezoneOffset()*6e4+24*60*60*1e3);var i=";expires="+(new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate())).toUTCString().replace(/ [0-9]+\:/," 00:")}else{var i=""}document.cookie=e+"="+t+i+";path=/;"};TBRUM.beforeUnload=function(e){TBRUM.setCookie("TBRUM","s="+Number(new Date)+"&r="+escape(document.location))};TBRUM.onload=function(e){TBRUM.mark("onload",(new Date).getTime());if(TBRUM.autorun){TBRUM.done()}};TBRUM.addEventListener=function(e,t,n){if("undefined"!=typeof window.attachEvent){return window.attachEvent("on"+e,t)}else if(window.addEventListener){return window.addEventListener(e,t,n)}};TBRUM.init();TBRUM.mark("script-done",(new Date).getTime())