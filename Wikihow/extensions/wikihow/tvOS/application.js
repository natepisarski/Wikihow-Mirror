var TAFFY,exports,T;function Catalog(t={}){this.options=t}function CategorizedCatalog(t={}){Catalog.call(this,t)}function IndexedCatalog(t={}){Catalog.call(this,t),this.filter=t.filter,this.limit=9,this.offset=0}function View(t={}){this.options=t}function AsyncView(t={}){View.call(this,t)}function CategoryView(t,e={}){AsyncView.call(this,e),this.catalog=t}function IndexView(t,e={}){AsyncView.call(this,e),this.catalog=t}function MenuBarView(t={}){View.call(this,t),this.render(MenuBarView.templates.document,t),this.document.addEventListener("select",this.onSelect.bind(this)),this.children={},t.items.forEach(t=>{this.children[t.key]=t.view})}!function(t,e){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t.Mustache={},e(t.Mustache))}(this,function(t){var e=Object.prototype.toString,n=Array.isArray||function(t){return"[object Array]"===e.call(t)};function r(t){return"function"==typeof t}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(t,e){return null!=t&&"object"==typeof t&&e in t}var s=RegExp.prototype.test;var a=/\S/;function c(t){return e=a,n=t,!s.call(e,n);var e,n}var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var l=/\s*/,h=/\s+/,f=/\s*=/,p=/\s*\}/,d=/#|\^|\/|>|\{|&|=|!/;function g(t){this.string=t,this.tail=t,this.pos=0}function y(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function T(){this.cache={}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},g.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},y.prototype.push=function(t){return new y(t,this)},y.prototype.lookup=function(t){var e,n=this.cache;if(n.hasOwnProperty(t))e=n[t];else{for(var i,s,a=this,c=!1;a;){if(t.indexOf(".")>0)for(e=a.view,i=t.split("."),s=0;null!=e&&s<i.length;)s===i.length-1&&(c=o(e,i[s])),e=e[i[s++]];else e=a.view[t],c=o(a.view,t);if(c)break;a=a.parent}n[t]=e}return r(e)&&(e=e.call(this.view)),e},T.prototype.clearCache=function(){this.cache={}},T.prototype.parse=function(e,r){var o=this.cache,s=o[e];return null==s&&(s=o[e]=function(e,r){if(!e)return[];var o,s,a,u=[],y=[],T=[],m=!1,v=!1;function w(){if(m&&!v)for(;T.length;)delete y[T.pop()];else T=[];m=!1,v=!1}function F(t){if("string"==typeof t&&(t=t.split(h,2)),!n(t)||2!==t.length)throw new Error("Invalid tags: "+t);o=new RegExp(i(t[0])+"\\s*"),s=new RegExp("\\s*"+i(t[1])),a=new RegExp("\\s*"+i("}"+t[1]))}F(r||t.tags);for(var A,x,b,C,_,O,I=new g(e);!I.eos();){if(A=I.pos,b=I.scanUntil(o))for(var Y=0,V=b.length;Y<V;++Y)c(C=b.charAt(Y))?T.push(y.length):v=!0,y.push(["text",C,A,A+1]),A+=1,"\n"===C&&w();if(!I.scan(o))break;if(m=!0,x=I.scan(d)||"name",I.scan(l),"="===x?(b=I.scanUntil(f),I.scan(f),I.scanUntil(s)):"{"===x?(b=I.scanUntil(a),I.scan(p),I.scanUntil(s),x="&"):b=I.scanUntil(s),!I.scan(s))throw new Error("Unclosed tag at "+I.pos);if(_=[x,b,A,I.pos],y.push(_),"#"===x||"^"===x)u.push(_);else if("/"===x){if(!(O=u.pop()))throw new Error('Unopened section "'+b+'" at '+A);if(O[1]!==b)throw new Error('Unclosed section "'+O[1]+'" at '+A)}else"name"===x||"{"===x||"&"===x?v=!0:"="===x&&F(b)}if(O=u.pop())throw new Error('Unclosed section "'+O[1]+'" at '+I.pos);return function(t){for(var e,n=[],r=n,i=[],o=0,s=t.length;o<s;++o)switch((e=t[o])[0]){case"#":case"^":r.push(e),i.push(e),r=e[4]=[];break;case"/":i.pop()[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}(function(t){for(var e,n,r=[],i=0,o=t.length;i<o;++i)(e=t[i])&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(r.push(e),n=e));return r}(y))}(e,r)),s},T.prototype.render=function(t,e,n){var r=this.parse(t),i=e instanceof y?e:new y(e);return this.renderTokens(r,i,n,t)},T.prototype.renderTokens=function(t,e,n,r){for(var i,o,s,a="",c=0,u=t.length;c<u;++c)s=void 0,"#"===(o=(i=t[c])[0])?s=this.renderSection(i,e,n,r):"^"===o?s=this.renderInverted(i,e,n,r):">"===o?s=this.renderPartial(i,e,n,r):"&"===o?s=this.unescapedValue(i,e):"name"===o?s=this.escapedValue(i,e):"text"===o&&(s=this.rawValue(i)),void 0!==s&&(a+=s);return a},T.prototype.renderSection=function(t,e,i,o){var s=this,a="",c=e.lookup(t[1]);if(c){if(n(c))for(var u=0,l=c.length;u<l;++u)a+=this.renderTokens(t[4],e.push(c[u]),i,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)a+=this.renderTokens(t[4],e.push(c),i,o);else if(r(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(e.view,o.slice(t[3],t[5]),function(t){return s.render(t,e,i)}))&&(a+=c)}else a+=this.renderTokens(t[4],e,i,o);return a}},T.prototype.renderInverted=function(t,e,r,i){var o=e.lookup(t[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(t[4],e,r,i)},T.prototype.renderPartial=function(t,e,n){if(n){var i=r(n)?n(t[1]):n[t[1]];return null!=i?this.renderTokens(this.parse(i),e,n,i):void 0}},T.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);if(null!=n)return n},T.prototype.escapedValue=function(e,n){var r=n.lookup(e[1]);if(null!=r)return t.escape(r)},T.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.3.0",t.tags=["{{","}}"];var m=new T;return t.clearCache=function(){return m.clearCache()},t.parse=function(t,e){return m.parse(t,e)},t.render=function(t,e,r){if("string"!=typeof t)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(i=t)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return m.render(t,e,r)},t.to_html=function(e,n,i,o){var s=t.render(e,n,i);if(!r(o))return s;o(s)},t.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return u[t]})},t.Scanner=g,t.Context=y,t.Writer=T,t}),function(){"use strict";var t,e,n,r,i,o,s,a,c,u,l,h,f,p,d,g,y,m,v,w,F,A;if(!TAFFY)for("2.7",i=1,o="000000",s=1e3,a={},A=function(t){return Array.prototype.slice.call(t).sort()},c=function(t){return TAFFY.isArray(t)||TAFFY.isObject(t)?t:JSON.parse(t)},function(t,e){return m(t,function(t){return e.indexOf(t)>=0})},m=function(t,e,n){var r=[];return null==t?r:Array.prototype.filter&&t.filter===Array.prototype.filter?t.filter(e,n):(u(t,function(t,i,o){e.call(n,t,i,o)&&(r[r.length]=t)}),r)},F=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},w=function(t){var e=T.isArray(t)?[]:T.isObject(t)?{}:null;if(null===t)return t;for(var n in t)e[n]=F(t[n])?t[n].toString():T.isArray(t[n])||T.isObject(t[n])?w(t[n]):t[n];return e},v=function(t){var e=JSON.stringify(t);return null===e.match(/regex/)?e:JSON.stringify(w(t))},u=function(t,e,n){var r,i,o,s;if(t&&(T.isArray(t)&&1===t.length||!T.isArray(t)))e(T.isArray(t)?t[0]:t,0);else for(o=0,t=T.isArray(t)?t:[t],s=t.length;s>o&&(i=t[o],T.isUndefined(i)&&!n||(r=e(i,o),r!==T.EXIT));o++);},l=function(t,e){var n,r,i=0;for(r in t)if(t.hasOwnProperty(r)&&(n=e(t[r],r,i++),n===T.EXIT))break},a.extend=function(t,e){a[t]=function(){return e.apply(this,A(arguments))}},h=function(t){var e;return!(!T.isString(t)||!/[t][0-9]*[r][0-9]*/i.test(t))||(!!(T.isObject(t)&&t.___id&&t.___s)||!!T.isArray(t)&&(e=!0,u(t,function(t){return h(t)?void 0:(e=!1,TAFFY.EXIT)}),e))},p=function(t,e){var n=!0;return u(e,function(e){switch(T.typeOf(e)){case"function":if(!e.apply(t))return n=!1,TAFFY.EXIT;break;case"array":n=1===e.length?p(t,e[0]):2===e.length?p(t,e[0])||p(t,e[1]):3===e.length?p(t,e[0])||p(t,e[1])||p(t,e[2]):4===e.length&&(p(t,e[0])||p(t,e[1])||p(t,e[2])||p(t,e[3])),e.length>4&&u(e,function(e){p(t,e)&&(n=!0)})}}),n},f=function(t){var e=[];return T.isString(t)&&/[t][0-9]*[r][0-9]*/i.test(t)&&(t={___id:t}),T.isArray(t)?(u(t,function(t){e.push(f(t))}),t=function(){var t=this,n=!1;return u(e,function(e){p(t,e)&&(n=!0)}),n}):T.isObject(t)?(T.isObject(t)&&t.___id&&t.___s&&(t={___id:t.___id}),l(t,function(t,n){T.isObject(t)||(t={is:t}),l(t,function(t,r){var i=[];("hasAll"===r?function(t,e){e(t)}:u)(t,function(t){var e,o=!0;e=function(){var e,i=this[n];return void 0!==i&&(0===r.indexOf("!")&&"!="!==r&&"!=="!==r&&(o=!1,r=r.substring(1,r.length)),e=!((e="regex"===r?t.test(i):"lt"===r||"<"===r?t>i:"gt"===r||">"===r?i>t:"lte"===r||"<="===r?t>=i:"gte"===r||">="===r?i>=t:"left"===r?0===i.indexOf(t):"leftnocase"===r?0===i.toLowerCase().indexOf(t.toLowerCase()):"right"===r?i.substring(i.length-t.length)===t:"rightnocase"===r?i.toLowerCase().substring(i.length-t.length)===t.toLowerCase():"like"===r?i.indexOf(t)>=0:"likenocase"===r?i.toLowerCase().indexOf(t.toLowerCase())>=0:"==="===r||"is"===r?i===t:"=="===r?i==t:"!=="===r?i!==t:"!="===r?i!=t:"isnocase"===r?i.toLowerCase?i.toLowerCase()===t.toLowerCase():i===t:"has"===r?T.has(i,t):"hasall"===r?T.hasAll(i,t):"contains"===r?TAFFY.isArray(i)&&i.indexOf(t)>-1:-1!==r.indexOf("is")||TAFFY.isNull(i)||TAFFY.isUndefined(i)||TAFFY.isObject(t)||TAFFY.isArray(t)?T[r]&&T.isFunction(T[r])&&0===r.indexOf("is")?T[r](i)===t:!(!T[r]||!T.isFunction(T[r]))&&T[r](i,t):t===i[r])&&!o)&&(!e&&!o||e))},i.push(e)}),e.push(1===i.length?i[0]:function(){var t=this,e=!1;return u(i,function(n){n.apply(t)&&(e=!0)}),e})})}),t=function(){var t=this,n=!0;return n=!(1===e.length&&!e[0].apply(t)||!(2!==e.length||e[0].apply(t)&&e[1].apply(t))||!(3!==e.length||e[0].apply(t)&&e[1].apply(t)&&e[2].apply(t))||!(4!==e.length||e[0].apply(t)&&e[1].apply(t)&&e[2].apply(t)&&e[3].apply(t))),e.length>4&&u(e,function(e){p(t,e)||(n=!1)}),n}):T.isFunction(t)?t:void 0},g=function(t,e){return t&&t.push?t.sort(function(t,n){var r=0;return T.each(e,function(e){var i,o,s,a,c;if(o=(i=e.split(" "))[0],"logical"===(s=1===i.length?"logical":i[1]))a=d(t[o]),c=d(n[o]),T.each(a.length<=c.length?a:c,function(t,e){return a[e]<c[e]?(r=-1,TAFFY.EXIT):a[e]>c[e]?(r=1,TAFFY.EXIT):void 0});else if("logicaldesc"===s)a=d(t[o]),c=d(n[o]),T.each(a.length<=c.length?a:c,function(t,e){return a[e]>c[e]?(r=-1,TAFFY.EXIT):a[e]<c[e]?(r=1,TAFFY.EXIT):void 0});else{if("asec"===s&&t[o]<n[o])return r=-1,T.EXIT;if("asec"===s&&t[o]>n[o])return r=1,T.EXIT;if("desc"===s&&t[o]>n[o])return r=-1,T.EXIT;if("desc"===s&&t[o]<n[o])return r=1,T.EXIT}return 0===r&&"logical"===s&&a.length<c.length?r=-1:0===r&&"logical"===s&&a.length>c.length?r=1:0===r&&"logicaldesc"===s&&a.length>c.length?r=-1:0===r&&"logicaldesc"===s&&a.length<c.length&&(r=1),0!==r?T.EXIT:void 0}),r}):t},function(){var t={},e=0;d=function(n){return e>s&&(t={},e=0),t["_"+n]||function(){var r,i,o,s=String(n),a=[],c="_",u="";for(r=0,i=s.length;i>r;r++)o=s.charCodeAt(r),o>=48&&57>=o||46===o?("n"!==u&&(u="n",a.push(c.toLowerCase()),c=""),c+=s.charAt(r)):("s"!==u&&(u="s",a.push(parseFloat(c)),c=""),c+=s.charAt(r));return a.push("n"===u?parseFloat(c):c.toLowerCase()),a.shift(),t["_"+n]=a,e++,a}()}}(),y=function(){this.context({results:this.getDBI().query(this.context())})},a.extend("filter",function(){var t=TAFFY.mergeObj(this.context(),{run:null}),e=[];return u(t.q,function(t){e.push(t)}),t.q=e,u(A(arguments),function(e){t.q.push(f(e)),t.filterRaw.push(e)}),this.getroot(t)}),a.extend("order",function(t){t=t.split(",");var e,n=[];return u(t,function(t){n.push(t.replace(/^\s*/,"").replace(/\s*$/,""))}),(e=TAFFY.mergeObj(this.context(),{sort:null})).order=n,this.getroot(e)}),a.extend("limit",function(t){var e,n=TAFFY.mergeObj(this.context(),{});return n.limit=t,n.run&&n.sort&&(e=[],u(n.results,function(n,r){return r+1>t?TAFFY.EXIT:void e.push(n)}),n.results=e),this.getroot(n)}),a.extend("start",function(t){var e,n=TAFFY.mergeObj(this.context(),{});return n.start=t,n.run&&n.sort&&!n.limit?(e=[],u(n.results,function(n,r){r+1>t&&e.push(n)}),n.results=e):n=TAFFY.mergeObj(this.context(),{run:null,start:t}),this.getroot(n)}),a.extend("update",function(t,e,n){var r,i=!0,o={},s=A(arguments);return!TAFFY.isString(t)||2!==arguments.length&&3!==arguments.length?(o=t,2===s.length&&(i=e)):(o[t]=e,3===arguments.length&&(i=n)),r=this,y.call(this),u(this.context().results,function(t){var e=o;TAFFY.isFunction(e)?e=e.apply(TAFFY.mergeObj(t,{})):T.isFunction(e)&&(e=e(TAFFY.mergeObj(t,{}))),TAFFY.isObject(e)&&r.getDBI().update(t.___id,e,i)}),this.context().results.length&&this.context({run:null}),this}),a.extend("remove",function(t){var e=this,n=0;return y.call(this),u(this.context().results,function(t){e.getDBI().remove(t.___id),n++}),this.context().results.length&&(this.context({run:null}),e.getDBI().removeCommit(t)),n}),a.extend("count",function(){return y.call(this),this.context().results.length}),a.extend("callback",function(t,e){if(t){var n=this;setTimeout(function(){y.call(n),t.call(n.getroot(n.context()))},e||0)}return null}),a.extend("get",function(){return y.call(this),this.context().results}),a.extend("stringify",function(){return JSON.stringify(this.get())}),a.extend("first",function(){return y.call(this),this.context().results[0]||!1}),a.extend("last",function(){return y.call(this),this.context().results[this.context().results.length-1]||!1}),a.extend("sum",function(){var t=0,e=this;return y.call(e),u(A(arguments),function(n){u(e.context().results,function(e){t+=e[n]||0})}),t}),a.extend("min",function(t){var e=null;return y.call(this),u(this.context().results,function(n){(null===e||n[t]<e)&&(e=n[t])}),e}),function(){var t,e,n=(t=function(t,e,n){var r,i,o;switch(2===n.length?(r=t[n[0]],o="===",i=e[n[1]]):(r=t[n[0]],o=n[1],i=e[n[2]]),o){case"===":return r===i;case"!==":return r!==i;case"<":return i>r;case">":return r>i;case"<=":return i>=r;case">=":return r>=i;case"==":return r==i;case"!=":return r!=i;default:throw String(o)+" is not supported"}},e=function(t,e){var n,r,i={};for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);for(n in e)e.hasOwnProperty(n)&&"___id"!==n&&"___s"!==n&&(r=TAFFY.isUndefined(i[n])?"":"right_",i[r+String(n)]=e[n]);return i},function(n){var r,i,o=A(arguments),s=o.length,a=[];if("function"!=typeof n.filter){if(!n.TAFFY)throw"TAFFY DB or result not supplied";r=n()}else r=n;return this.context({results:this.getDBI().query(this.context())}),TAFFY.each(this.context().results,function(n){r.each(function(r){var c,u=!0;for(i=1;s>i&&(u="function"==typeof(c=o[i])?c(n,r):!("object"!=typeof c||!c.length)&&t(n,r,c));i++);u&&a.push(e(n,r))})}),TAFFY(a)()});a.extend("join",n)}(),a.extend("max",function(t){var e=null;return y.call(this),u(this.context().results,function(n){(null===e||n[t]>e)&&(e=n[t])}),e}),a.extend("select",function(){var t=[],e=A(arguments);return y.call(this),1===arguments.length?u(this.context().results,function(n){t.push(n[e[0]])}):u(this.context().results,function(n){var r=[];u(e,function(t){r.push(n[t])}),t.push(r)}),t}),a.extend("distinct",function(){var t=[],e=A(arguments);return y.call(this),1===arguments.length?u(this.context().results,function(n){var r=n[e[0]],i=!1;u(t,function(t){return r===t?(i=!0,TAFFY.EXIT):void 0}),i||t.push(r)}):u(this.context().results,function(n){var r=[],i=!1;u(e,function(t){r.push(n[t])}),u(t,function(t){var n=!0;return u(e,function(e,i){return r[i]!==t[i]?(n=!1,TAFFY.EXIT):void 0}),n?(i=!0,TAFFY.EXIT):void 0}),i||t.push(r)}),t}),a.extend("supplant",function(t,e){var n=[];return y.call(this),u(this.context().results,function(e){n.push(t.replace(/\{([^\{\}]*)\}/g,function(t,n){var r=e[n];return"string"==typeof r||"number"==typeof r?r:t}))}),e?n:n.join("")}),a.extend("each",function(t){return y.call(this),u(this.context().results,t),this}),a.extend("map",function(t){var e=[];return y.call(this),u(this.context().results,function(n){e.push(t(n))}),e}),T=function(t){var e,n,r,s=[],d={},y=1,m={template:!1,onInsert:!1,onUpdate:!1,onRemove:!1,onDBChange:!1,storageName:!1,forcePropertyCase:null,cacheSize:100,name:""},w=new Date,F=0,x=0,b={};return n=function(t){var e=[],r=!1;return 0===t.length?s:(u(t,function(t){T.isString(t)&&/[t][0-9]*[r][0-9]*/i.test(t)&&s[d[t]]&&(e.push(s[d[t]]),r=!0),T.isObject(t)&&t.___id&&t.___s&&s[d[t.___id]]&&(e.push(s[d[t.___id]]),r=!0),T.isArray(t)&&u(t,function(t){u(n(t),function(t){e.push(t)})})}),r&&e.length>1&&(e=[]),e)},e={dm:function(t){return t&&(w=t,b={},F=0,x=0),m.onDBChange&&setTimeout(function(){m.onDBChange.call(s)},0),m.storageName&&setTimeout(function(){localStorage.setItem("taffy_"+m.storageName,JSON.stringify(s))}),w},insert:function(t,n){var a=[],h=[],f=c(t);return u(f,function(t,r){var c,f;return T.isArray(t)&&0===r?(u(t,function(t){a.push("lower"===m.forcePropertyCase?t.toLowerCase():"upper"===m.forcePropertyCase?t.toUpperCase():t)}),!0):(T.isArray(t)?(c={},u(t,function(t,e){c[a[e]]=t}),t=c):T.isObject(t)&&m.forcePropertyCase&&(f={},l(t,function(e,n){f["lower"===m.forcePropertyCase?n.toLowerCase():"upper"===m.forcePropertyCase?n.toUpperCase():n]=t[n]}),t=f),y++,t.___id="T"+String(o+i).slice(-6)+"R"+String(o+y).slice(-6),t.___s=!0,h.push(t.___id),m.template&&(t=T.mergeObj(m.template,t)),s.push(t),d[t.___id]=s.length-1,m.onInsert&&(n||TAFFY.isUndefined(n))&&m.onInsert.call(t),void e.dm(new Date))}),r(h)},sort:function(t){return s=g(s,t.split(",")),d={},u(s,function(t,e){d[t.___id]=e}),e.dm(new Date),!0},update:function(t,n,r){var i,o,a,c,u={};m.forcePropertyCase&&(l(n,function(t,e){u["lower"===m.forcePropertyCase?e.toLowerCase():"upper"===m.forcePropertyCase?e.toUpperCase():e]=t}),n=u),i=s[d[t]],o=T.mergeObj(i,n),a={},c=!1,l(o,function(t,e){(TAFFY.isUndefined(i[e])||i[e]!==t)&&(a[e]=t,c=!0)}),c&&(m.onUpdate&&(r||TAFFY.isUndefined(r))&&m.onUpdate.call(o,s[d[t]],a),s[d[t]]=o,e.dm(new Date))},remove:function(t){s[d[t]].___s=!1},removeCommit:function(t){var n;for(n=s.length-1;n>-1;n--)s[n].___s||(m.onRemove&&(t||TAFFY.isUndefined(t))&&m.onRemove.call(s[n]),d[s[n].___id]=void 0,s.splice(n,1));d={},u(s,function(t,e){d[t.___id]=e}),e.dm(new Date)},query:function(t){var r,i,o,a,c,h;if(m.cacheSize&&(i="",u(t.filterRaw,function(t){return T.isFunction(t)?(i="nocache",TAFFY.EXIT):void 0}),""===i&&(i=v(T.mergeObj(t,{q:!1,run:!1,sort:!1})))),!t.results||!t.run||t.run&&e.dm()>t.run){if(o=[],m.cacheSize&&b[i])return b[i].i=F++,b[i].results;0===t.q.length&&0===t.index.length?(u(s,function(t){o.push(t)}),r=o):(a=n(t.index),u(a,function(e){(0===t.q.length||p(e,t.q))&&o.push(e)}),r=o)}else r=t.results;return!(t.order.length>0)||t.run&&t.sort||(r=g(r,t.order)),r.length&&(t.limit&&t.limit<r.length||t.start)&&(c=[],u(r,function(e,n){if(!t.start||t.start&&n+1>=t.start)if(t.limit){if((h=t.start?n+1-t.start:n)<t.limit)c.push(e);else if(h>t.limit)return TAFFY.EXIT}else c.push(e)}),r=c),m.cacheSize&&"nocache"!==i&&(x++,setTimeout(function(){var t,e;x>=2*m.cacheSize&&(x=0,t=F-m.cacheSize,e={},l(function(n,r){n.i>=t&&(e[r]=n)}),b=e)},0),b[i]={i:F++,results:r}),r}},r=function(){var t,n;return t=TAFFY.mergeObj(TAFFY.mergeObj(a,{insert:void 0}),{getDBI:function(){return e},getroot:function(t){return r.call(t)},context:function(t){return t&&(n=TAFFY.mergeObj(n,t.hasOwnProperty("results")?TAFFY.mergeObj(t,{run:new Date,sort:new Date}):t)),n},extend:void 0}),n=this&&this.q?this:{limit:!1,start:!1,q:[],filterRaw:[],index:[],order:[],results:!1,run:null,sort:null,settings:m},u(A(arguments),function(t){h(t)?n.index.push(t):n.q.push(f(t)),n.filterRaw.push(t)}),t},i++,t&&e.insert(t),r.insert=e.insert,r.merge=function(t,n,i){var o={},s=[],a={};return i=i||!1,n=n||"id",u(t,function(t){var a;o[n]=t[n],s.push(t[n]),(a=r(o).first())?e.update(a.___id,t,i):e.insert(t,i)}),a[n]=s,r(a)},r.TAFFY=!0,r.sort=e.sort,r.settings=function(t){return t&&(m=TAFFY.mergeObj(m,t),t.template&&r().update(t.template)),m},r.store=function(t){var e;return localStorage&&(t&&((e=localStorage.getItem("taffy_"+t))&&e.length>0&&(r.insert(e),!0),s.length>0&&setTimeout(function(){localStorage.setItem("taffy_"+m.storageName,JSON.stringify(s))})),r.settings({storageName:t})),r},r},TAFFY=T,T.each=u,T.eachin=l,T.extend=a.extend,TAFFY.EXIT="TAFFYEXIT",TAFFY.mergeObj=function(t,e){var n={};return l(t,function(e,r){n[r]=t[r]}),l(e,function(t,r){n[r]=e[r]}),n},TAFFY.has=function(t,e){var n,r=!1;if(t.TAFFY)return r=t(e),r.length>0;switch(T.typeOf(t)){case"object":if(T.isObject(e))l(e,function(n,i){return!0!==r||T.isUndefined(t[i])||!t.hasOwnProperty(i)?(r=!1,TAFFY.EXIT):void(r=T.has(t[i],e[i]))});else if(T.isArray(e))u(e,function(n,i){return(r=T.has(t,e[i]))?TAFFY.EXIT:void 0});else if(T.isString(e))return!TAFFY.isUndefined(t[e]);return r;case"array":if(T.isObject(e))u(t,function(n,i){return!0===(r=T.has(t[i],e))?TAFFY.EXIT:void 0});else if(T.isArray(e))u(e,function(n,i){return u(t,function(n,o){return!0===(r=T.has(t[o],e[i]))?TAFFY.EXIT:void 0}),!0===r?TAFFY.EXIT:void 0});else if(T.isString(e)||T.isNumber(e))for(r=!1,n=0;n<t.length;n++)if(r=T.has(t[n],e))return!0;return r;case"string":if(T.isString(e)&&e===t)return!0;break;default:if(T.typeOf(t)===T.typeOf(e)&&t===e)return!0}return!1},TAFFY.hasAll=function(t,e){var n,r=TAFFY;return r.isArray(e)?(n=!0,u(e,function(e){return!1===(n=r.has(t,e))?TAFFY.EXIT:void 0}),n):r.has(t,e)},TAFFY.typeOf=function(t){var e=typeof t;return"object"===e&&(t?"number"!=typeof t.length||t.propertyIsEnumerable("length")||(e="array"):e="null"),e},TAFFY.getObjectKeys=function(t){var e=[];return l(t,function(t,n){e.push(n)}),e.sort(),e},TAFFY.isSameArray=function(t,e){return!(!TAFFY.isArray(t)||!TAFFY.isArray(e)||t.join(",")!==e.join(","))},TAFFY.isSameObject=function(t,e){var n=TAFFY,r=!0;return n.isObject(t)&&n.isObject(e)&&n.isSameArray(n.getObjectKeys(t),n.getObjectKeys(e))?l(t,function(i,o){return n.isObject(t[o])&&n.isObject(e[o])&&n.isSameObject(t[o],e[o])||n.isArray(t[o])&&n.isArray(e[o])&&n.isSameArray(t[o],e[o])||t[o]===e[o]?void 0:(r=!1,TAFFY.EXIT)}):r=!1,r},t=["String","Number","Object","Array","Boolean","Null","Function","Undefined"],e=function(t){return function(e){return TAFFY.typeOf(e)===t.toLowerCase()}},n=0;n<t.length;n++)r=t[n],TAFFY["is"+r]=e(r)}(),"object"==typeof exports&&(exports.taffy=TAFFY),Catalog.api="https://www.wikihow.com/api.php?action=summary_videos&format=json",Catalog.database=null,Catalog.load=function(){return new Promise((t,e)=>{if(this.database)t(this.database);else{var n=new XMLHttpRequest;n.responseType="json",n.addEventListener("load",()=>{var e=JSON.parse(n.responseText).query.summary_videos.videos,r=this.database=TAFFY(e),i=JSON.parse(localStorage.getItem("watched")||"[]");r().update(function(){return this.watched=i.indexOf(parseInt(this.id))>-1,this}),t(this.database)}),n.addEventListener("error",e),n.open("GET",this.api,!0),n.send()}})},Catalog.persist=function(){if(Catalog.database){var t=Catalog.database().filter({watched:!0}).select("id");localStorage.setItem("watched",JSON.stringify(t.map(t=>parseInt(t))))}},CategorizedCatalog.prototype=Object.create(Catalog.prototype),CategorizedCatalog.prototype.constructor=CategorizedCatalog,CategorizedCatalog.prototype.fetch=function(){return Catalog.load().then(t=>Object.values(t().get().reduce((t,e)=>(e.categories.split(",").forEach(n=>{t[n]||(t[n]={title:n,videos:[]}),e.badge=e.watched?"resource://button-checkmark":"",t[n].videos.push(e)}),t),{})))},IndexedCatalog.prototype=Object.create(Catalog.prototype),IndexedCatalog.prototype.constructor=IndexedCatalog,IndexedCatalog.prototype.fetch=function(){return Catalog.load().then(t=>{var e=t().filter(this.filter).start(this.offset).limit(this.limit).get();return e?(e.forEach(t=>{t.badge=t.watched?"resource://button-checkmark":""}),this.offset+=e.length,e):[]})},IndexedCatalog.prototype.reset=function(){this.limit=9,this.offset=0},View.templates={},View.templates.videoLockups='\n\t{{#videos}}\n\t<lockup data-video="{{{video}}}" data-id="{{id}}">\n\t\t<img src="{{{poster}}}" width="548" height="308" />\n\t\t<overlay>\n\t\t\t<badge src="{{badge}}" style="tv-align: right; tv-position: bottom-right" />\n\t\t</overlay>\n\t\t<title>{{title}}</title>\n\t</lockup>\n\t{{/videos}}',View.templates.videosGrid=`\n\t<grid>\n\t\t<section>\n\t\t\t${View.templates.videoLockups}\n\t\t</section>\n\t</grid>`,View.play=function(t){var e=t.getAttribute("data-video");if(e){var n=new Player;n.playlist=new Playlist,n.playlist.push(new MediaItem("video",e)),n.play();var r=t.getAttribute("data-id");if(r)return Catalog.load().then(t=>{t().filter({id:r}).update({watched:!0}),Catalog.persist()}),t.getElementsByTagName("overlay").item(0).getElementsByTagName("badge").item(0).setAttribute("src","resource://button-checkmark"),!0}return!1},View.prototype.render=function(t,e){this.parse(Mustache.render(t,e))},View.prototype.parse=function(t){t='<?xml version="1.0" encoding="UTF-8" ?>'+t,View.parser||(View.parser=new DOMParser),this.document=View.parser.parseFromString(t,"application/xml")},AsyncView.prototype=Object.create(View.prototype),AsyncView.prototype.constructor=AsyncView,AsyncView.prototype.load=function(){throw new Error("Subclass must override")},CategoryView.prototype=Object.create(AsyncView.prototype),CategoryView.prototype.constructor=CategoryView,CategoryView.templates={},CategoryView.templates.document=`\n\t<document>\n        <head>\n            <style>\n            .container {\n                background-color: rgba(255,255,255,0.5);\n                color: #000;\n            }\n        \t</style>\n        </head>\n\t\t<catalogTemplate class="container">\n\t\t\t<list>\n\t\t\t\t<section>\n\t\t\t\t\t{{#categories}}\n\t\t\t\t\t<listItemLockup>\n\t\t\t\t\t\t<title>{{title}}</title>\n\t\t\t\t\t\t<decorationLabel>{{videos.length}}</decorationLabel>\n\t\t\t\t\t\t<relatedContent>${View.templates.videosGrid}</relatedContent>\n\t\t\t\t\t</listItemLockup>\n\t\t\t\t\t{{/categories}}\n\t\t\t\t</section>\n\t\t\t</list>\n\t\t</catalogTemplate>\n\t</document>`,CategoryView.prototype.load=function(){return this.catalog.fetch().then(t=>{this.render(CategoryView.templates.document,{categories:t}),this.document.addEventListener("select",this.onSelect.bind(this))})},CategoryView.prototype.onSelect=function(t){return View.play(t.target),!1},IndexView.prototype=Object.create(AsyncView.prototype),IndexView.prototype.constructor=IndexView,IndexView.templates={},IndexView.templates.stack=`\n\t<document>\n\t\t<head>\n\t\t\t<style>\n\t\t\t.container {\n\t\t\t\tbackground-color: rgba(255,255,255,0.5);\n\t\t\t\tcolor: #000;\n\t\t\t}\n\t\t\t</style>\n\t\t</head>\n\t\t<stackTemplate class="container">\n\t\t\t<collectionList>${View.templates.videosGrid}</collectionList>\n\t\t</stackTemplate>\n\t</document>`,IndexView.templates.alert="\n\t<document>\n\t\t<head>\n\t\t\t<style>\n\t\t\t.container {\n\t\t\t\tbackground-color: rgba(255,255,255,0.5);\n\t\t\t\tcolor: #000;\n\t\t\t}\n\t\t\t</style>\n\t\t</head>\n\t\t<alertTemplate>\n\t\t\t<title>Nothing here yet</title>\n\t\t\t<description>You haven't watched anything</description>\n\t\t</alertTemplate>\n\t</document>",IndexView.prototype.load=function(){return this.catalog.reset(),this.catalog.fetch().then(t=>{t.length?(this.render(IndexView.templates.stack,{videos:t}),this.document.getElementsByTagName("stackTemplate").item(0).addEventListener("needsmore",this.onNeedsMore.bind(this)),this.document.addEventListener("select",this.onSelect.bind(this))):this.render(IndexView.templates.alert,{})})},IndexView.prototype.onNeedsMore=function(){var t=this.document.getElementsByTagName("grid").item(0).getElementsByTagName("section").item(0);this.catalog.fetch().then(e=>{var n=Mustache.render(View.templates.videoLockups,{videos:e});t.insertAdjacentHTML("beforeend",n)})},IndexView.prototype.onSelect=function(t){return View.play(t.target),!1},MenuBarView.prototype=Object.create(View.prototype),MenuBarView.prototype.constructor=MenuBarView,MenuBarView.templates={},MenuBarView.templates.document='\n\t<document>\n\t\t<menuBarTemplate>\n\t\t\t<menuBar>\n\t\t\t\t{{#items}}\n\t\t\t\t<menuItem data-target="{{key}}">\n\t\t\t\t\t<title>{{title}}</title>\n\t\t\t\t</menuItem>\n\t\t\t\t{{/items}}\n\t\t\t</menuBar>\n\t\t</menuBarTemplate>\n\t</document>',MenuBarView.prototype.onSelect=function(t){var e=t.target.getAttribute("data-target");"menuItem"==t.target.tagName&&this.children[e]&&this.children[e].load().then(()=>{t.target.parentNode.getFeature("MenuBarDocument").setDocument(this.children[e].document,t.target)})},App.onLaunch=function(t={}){this.options=t;var e=new MenuBarView({items:[{key:"unwatched",title:"Unwatched",view:new IndexView(new IndexedCatalog({filter:{watched:!1}}))},{key:"index",title:"Watch again",view:new IndexView(new IndexedCatalog({filter:{watched:!0}}))},{key:"categories",title:"Categories",view:new CategoryView(new CategorizedCatalog)}]});navigationDocument.pushDocument(e.document)};