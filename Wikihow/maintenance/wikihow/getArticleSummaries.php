<?php
//
// One time script to get a csv of article summaries from a list of article ids
//

require_once __DIR__ . '/../Maintenance.php';

class GetArticleSummaries extends Maintenance {
    public function __construct() {
        parent::__construct();
        $this->mDescription = 'One time script to get a csv of article summaries from a list of article ids';
    }

    public function execute() {
		$aids = [
			237241,
			23903,
			1438807,
			103839,
			2670018,
			58425,
			53808,
			2955749,
			1329333,
			1626735,
			43700,
			727297,
			221266,
			570404,
			16620,
			1081343,
			1718006,
			254340,
			7414,
			393890,
			324395,
			4570,
			3755,
			690279,
			1164749,
			2812241,
			4189788,
			38265,
			116370,
			5014,
			45604,
			644516,
			137710,
			20081,
			26227,
			35088,
			2345556,
			165189,
			934902,
			286580,
			2353038,
			86280,
			268503,
			616918,
			188110,
			1857419,
			2850877,
			30232,
			943593,
			9693,
			2357,
			1107823,
			168562,
			198872,
			20190,
			56552,
			929010,
			1566276,
			16878,
			1006888,
			12137,
			12193,
			54893,
			311207,
			6072,
			3311578,
			4554,
			274888,
			30227,
			187333,
			2669726,
			15756,
			22224,
			1505161,
			1404183,
			1123333,
			2768538,
			708208,
			319271,
			2901645,
			1003157,
			898664,
			21944,
			7517620,
			173268,
			1653,
			118118,
			929068,
			148689,
			4315,
			3149915,
			138813,
			244985,
			628008,
			3146213,
			33735,
			49809,
			49930,
			386770,
			20237,
			313748,
			1829689,
			1018256,
			126026,
			2585581,
			680783,
			43165,
			393474,
			21367,
			2787725,
			1098891,
			37745,
			8163,
			4281332,
			19462,
			1402105,
			42597,
			137300,
			564157,
			3150,
			4589,
			5458249,
			396021,
			769535,
			103746,
			7068,
			1387797,
			2100518,
			523435,
			929003,
			20398,
			140941,
			79029,
			132323,
			2850732,
			6162,
			139258,
			987919,
			31070,
			557349,
			167116,
			9550008,
			146960,
			783582,
			8001,
			46201,
			398913,
			2169629,
			328650,
			6661678,
			4289,
			1106648,
			20152,
			780562,
			24191,
			2202542,
			1332689,
			6914,
			34682,
			156309,
			1375416,
			139542,
			3467,
			123335,
			388043,
			5026,
			4132,
			2958770,
			105629,
			30576,
			117991,
			326038,
			1415105,
			1896,
			1108893,
			1332574,
			1932540,
			15303,
			2151998,
			169186,
			190660,
			887655,
			2574778,
			55685,
			662342,
			64123,
			154200,
			377063,
			1754000,
			167966,
			27619,
			3093491,
			34784,
			1058606,
			482185,
			9474911,
			677262,
			386007,
			91948,
			24288,
			416551,
			4191,
			787901,
			249746,
			283325,
			1322721,
			2437629,
			15590,
			3593751,
			1358869,
			1289121,
			10590,
			139942,
			73835,
			51367,
			254857,
			137849,
			4216,
			732584,
			435606,
			177678,
			2780809,
			63824,
			205656,
			590479,
			232460,
			490789,
			1170043,
			678306,
			46271,
			1628397,
			2723447,
			2723302,
			141563,
			1367404,
			449075,
			70286,
			130521,
			77562,
			73444,
			1630575,
			1385141,
			485741,
			239289,
			244114,
			135611,
			1337044,
			989190,
			2635004,
			106521,
			3410242,
			59993,
			43458,
			1392329,
			610019,
			59208,
			1359101,
			176284,
			33704,
			187683,
			3850,
			69220,
			7267,
			4347,
			1127186,
			725296,
			1391297,
			140116,
			277762,
			2078,
			131796,
			16974,
			512594,
			41140,
			20046,
			30037,
			2448980,
			118575,
			8661193,
			2987695,
			52272,
			563302,
			97245,
			306640,
			224352,
			9357382,
			1523669,
			98035,
			1420436,
			2896696,
			84863,
			56556,
			9229562,
			181984,
			10278,
			49313,
			844938,
			10019,
			245458,
			3202,
			6369007,
			14618,
			1305310,
			37464,
			670546,
			3311577,
			743618,
			3536080,
			1328544,
			1069185,
			1390231,
			2723854,
			317319,
			144890,
			31641,
			663332,
			1787463,
			75604,
			79797,
			56654,
			3259885,
			1357876,
			3918,
			77426,
			105171,
			15437,
			89682,
			2635168,
			1410968,
			1806175,
			275640,
			1487608,
			2418,
			239775,
			131655,
			3490935,
			362702,
			163585,
			1085486,
			3969639,
			34435,
			4706478,
			7071,
			701757,
			5143071,
			1321902,
			1072592,
			8663140,
			6784124,
			683718,
			190228,
			167428,
			258458,
			29286,
			660875,
			1437018,
			57226,
			1118973,
			518519,
			314980,
			1346418,
			56699,
			409595,
			167292,
			2172466,
			72962,
			4334325,
			239172,
			35960,
			645992,
			1807830,
			1582547,
			56136,
			136789,
			1492467,
			1339643,
			4877962,
			480030,
			50935,
			54138,
			12588,
			5747,
			3748684,
			49994,
			450205,
			178496,
			299535,
			711273,
			331098,
			380709,
			1359483,
			783137,
			8683788,
			97199,
			1397218,
			1351325,
			2955321,
			1341353,
			1365338,
			294416,
			162614,
			217960,
			121486,
			2947518,
			4776930,
			597612,
			1110109,
			1370226,
			1351981,
			497323,
			1943906,
			23440,
			7834,
			4106300,
			3458406,
			113644,
			6253558,
			190872,
			3638760,
			370584,
			8429746,
			2819104,
			279896,
			1389904,
			106756,
			42687,
			210221,
			353877,
			1372711,
			1374765,
			262824,
			62014,
			1385165,
			370633,
			667096,
			5215602,
			2687815,
			252608,
			3150262,
			4111964,
			121259,
			2780533,
			2693447,
			33685,
			2437365,
			757451,
			717149,
			156183,
			1370689,
			880109,
			522250,
			1221317,
			140407,
			946330,
			70285,
			199112,
			523527,
			1319857,
			631542,
			259054,
			3325232,
			1054064,
			1331212,
			1365792,
			2690682,
			32090,
			1571357,
			1452566,
			9293764,
			143407,
			1367729,
			4519415,
			2762378,
			1120425,
			723413,
			6573040,
			4206583,
			1630964,
			227949,
			679552,
			3101828,
			3749258,
			49977,
			465957,
			5539,
			81664,
			142599,
			60210,
			74901,
			23292,
			1496432,
			22262,
			5681,
			369207,
			248697,
			24851,
			2213249,
			136184,
			320686,
			411994,
			856005,
			426580,
			756297,
			1423290,
			135075,
			2687779,
			459993,
			649248,
			247322,
			37870,
			307571,
			230518,
			341049,
			113033,
			132904,
			260657,
			2142205,
			131654,
			64011,
			220810,
			185956,
			1095719,
			1265462,
			4219,
			185612,
			1120474,
			97641,
			268345,
			3715856,
			234167,
			256425,
			934824,
			7722,
			2114770,
			342816,
			4485187,
			12896,
			151854,
			7258444,
			101942,
			307555,
			579341,
			492406,
			2162998,
			341121,
			2428,
			180807,
			65105,
			190580,
			1376704,
			33159,
			173277,
			29996,
			1332367,
			22935,
			1281176,
			1803023,
			59481,
			1108884,
			87899,
			1182460,
			16119,
			551858,
			1272391,
			9431347,
			601160,
			50057,
			2582342,
			14694,
			849744,
			1170123,
			1080420,
			25610,
			3319741,
			645604,
			520173,
			384988,
			3748755,
			93155,
			778214,
			1576884,
			1356504,
			922974,
			28125,
			3570313,
			57931,
			433970,
			177244,
			845016,
			314296,
			173509,
			351074,
			1555561,
			109874,
			384626,
			2669873,
			236379,
			10852,
			838918,
			19328,
			1881129,
			321405,
			127497,
			13681,
			3196570,
			342983,
			5765,
			1228640,
			4342,
			198046,
			147355,
			293564,
			52660,
			2669999,
			54124,
			51392,
			45860,
			473391,
			52103,
			221132,
			60200,
			1519534,
			10816,
			1142683,
			1191090,
			1215252,
			3355969,
			74724,
			1215617,
			474757,
			1791620,
			210726,
			173256,
			15272,
			386813,
			88372,
			2948380,
			25655,
			13697,
			1099814,
			343949,
			150461,
			478005,
			4464,
			1368936,
			2958780,
			378029,
			1746,
			1344905,
			55715,
			921037,
			90904,
			2796895,
			3265389,
			1384812,
			2723473,
			1201616,
			522752,
			330205,
			409533,
			560530,
			1358470,
			2897039,
			73786,
			1534667,
			261298,
			782653,
			30982,
			459515,
			198743,
			7787813,
			1491603,
			690925,
			3630441,
			1664016,
			939333,
			41526,
			211984,
			392357,
			287711,
			1687509,
			1564270,
			1368347,
			291112,
			202971,
			21267,
			9603011,
			200833,
			9388730,
			13211,
			22609,
			27872,
			2135402,
			2730,
			3678,
			28335,
			205689,
			609066,
			279452,
			524364,
			197263,
			611527,
			98709,
			59277,
			85422,
			69077,
			811916,
		];
	    $fp = fopen('articleSummaries.csv', 'w');
	    fputcsv($fp, ['Article ID', 'Url', 'Summary', 'Error']);
		for ($i = 0; $i < sizeof($aids); $i++) {
			$aid = $aids[$i];
			$url = '';
			$summaryText = '';
			$errorText = '';
			$t = Title::newFromId($aid);

			if ($t && $t->exists()) {
				$url = 'https://www.wikihow.com/' . $t->getPartialUrl();
				$json = file_get_contents(
					"https://www.wikihow.com/api.php?action=articletext&aid=$aid&format=json");
				$obj = json_decode($json);
				//var_dump($obj);

				if (!$obj) {
					$errorText = 'No data returned from API call';
				} elseif ($obj->data->summaryText) {
					$summaryText = $obj->data->summaryText;
				} else {
					$errorText = 'Empty summary';
				}
			} else {
				$errorText = 'Title not found';
			}
			fputcsv($fp,
				[$aid, $url, $summaryText, $errorText]);
			echo "$aid\t$url\tError:$errorText\n";
		}
		fclose($fp);
    }
}

$maintClass = 'GetArticleSummaries';
require_once RUN_MAINTENANCE_IF_MAIN;
